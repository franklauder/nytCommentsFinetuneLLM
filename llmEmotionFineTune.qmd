---
title: "Fine Tuning LLM Emotion Predictions on New ork Times 2017 Comments"
format: html
---


# Introduction


# Data Inspection

```{python}

import torch


```

```{python}

import pandas as pd
import matplotlib as plt
import seaborn as sns


```

```{python}



from transformers import pipeline


```


```{python}


from transformers import AutoModel, AutoTokenizer
from transformers import AutoModelForSequenceClassification
from transformers import Trainer, TrainingArguments
from transformers.pipelines.pt_utils import KeyDataset
from tqdm.auto import tqdm





```


```{python}

from transformers.pipelines.pt_utils import KeyDataset




```

```{python}

from tqdm.auto import tqdm



```




```{python}


torch.cuda.is_available()



```


```{python}



file_path = r'C:\Users\fvlau\OneDrive\Documents\nytCommentsFinetuneLLM\\nyt_comments17_with_sentiment.csv'


```


```{python}


nytComments17_sentiments=pd.read_csv(file_path)



```



```{python}



nytComments17_sentiments.info()



```


```{python}


print(nytComments17_sentiments.shape)



```


```{python}

print(nytComments17_sentiments["sentiment"].value_counts())


```

```{python}

print(nytComments17_sentiments["sentiment"].value_counts(normalize=True).round(2))


```




```{python}


print(nytComments17_sentiments["typeOfMaterial"].value_counts(normalize=True).round(2))


```

```{python}



print(nytComments17_sentiments["newDesk"].value_counts(normalize=True).round(2))



```


```{python}



crashes=sns.load_dataset("car_crashes")


```

```{python}



crashes.head()



```

```{python}



print(nytComments17_sentiments[["typeOfMaterial", "sentiment"]].value_counts(normalize=True))


```

```{python}


print(nytComments17_sentiments[["newDesk", "sentiment"]].value_counts(normalize=True))



```






# Model Fine Tuning

```{python}


#pipe = pipeline("text-classification", model="cardiffnlp/twitter-roberta-base")


```


## Pre-process


The pre-trained model we are using has sentiment labels as: 0=negaticve, 1=neutral, 2=positive.  Since our dataset is labeled negative, neutral, and positive, we will convert them to integer values corresponding to the pre-trained model.

```{python}



rename_map={
    "negative": 0,
    "neutral": 1,
    "positive": 2
}




```

```{python}


nytComments17_sentiments['sentiment'] = nytComments17_sentiments['sentiment'].replace(rename_map)



```

```{python}




nytComments17_sentiments['sentiment'].value_counts()


```

Our dataset's sentiment labels now match the pre-trained model. 

```{python}


pipe=pipeline("text-classification", model="cardiffnlp/twitter-roberta-base-sentiment-latest")


```


```{python}


tokenizer = AutoTokenizer.from_pretrained("cardiffnlp/twitter-roberta-base-sentiment-latest")
model = AutoModelForSequenceClassification.from_pretrained("cardiffnlp/twitter-roberta-base-sentiment-latest")



```









